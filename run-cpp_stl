#!/bin/sh -e

. ./config

OBJ_DIR=$(pwd)/compiled/cpp_stl/bin
TEST_DIR=$(pwd)

# Compile everything:
# 1. KS runtime part for C++/STL
# 2. Binary format parser sources, generated by KS compiler
# 3. Test specs

#rm -rf "$OBJ_DIR"
mkdir -p "$OBJ_DIR"
cd "$OBJ_DIR"
if [ ! -r Makefile ]; then
	cmake -DCMAKE_BUILD_TYPE=Debug "$TEST_DIR/spec/cpp_stl"
fi
make

# Actually run the tests
cd "$TEST_DIR"
mkdir -p "$TEST_OUT_DIR/cpp_stl"
"$OBJ_DIR/ks_tests" \
	--log_format=XML \
	--log_sink="$TEST_OUT_DIR/cpp_stl/results.xml" \
	--log_level=all \
	--report_level=detailed
